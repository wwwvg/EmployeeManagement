<Window x:Class="EmployeeManagement.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:EmployeeManagement"
        xmlns:dlg="clr-namespace:EmployeeManagement.Views.Dialogs"
        mc:Ignorable="d"
        xmlns:prism="http://prismlibrary.com/" 
        xmlns:local1="clr-namespace:EmployeeManagement.Helpers"
        prism:ViewModelLocator.AutoWireViewModel="True"
        Title="Employee Management" Height="800" Width="1200">
    
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="b2v" />
        <local1:ProportionConverter x:Key="WidthConverter" />
    </Window.Resources>
    
    <Grid IsEnabled="{Binding IsInterfaceEnabled}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar Container -->
        <ToolBarTray Grid.Row="0">
            <!-- Group 1: Load/Save -->
            <ToolBar Band="1" BandIndex="1" Width="100">
                <Button Command="{Binding LoadEmployeesCommand}" Style="{StaticResource ToolbarButton}"
                        ToolTip="Загрузить БД">
                        <Image Source="/Resources/Icons/load.png" />
                </Button>
                <Button Command="{Binding SaveEmployeesCommand}" IsEnabled="False" Style="{StaticResource ToolbarButton}" Margin="10,0,0,0"
                        ToolTip="Сохранить БД">
                    <Image Source="/Resources/Icons/save.png"/>
                </Button>
            </ToolBar>

            <!-- Group 2: Employee Management -->
            <ToolBar Band="1" BandIndex="2" Width="140">
                <Button Command="{Binding CreateEmployeeCommand}" Style="{StaticResource ToolbarButton}"
                        ToolTip="Добавить работника">
                        <Image Source="/Resources/Icons/add.png" />
                </Button>
                <Button Command="{Binding EditEmployeeCommand}" Style="{StaticResource ToolbarButton}" Margin="10,0,0,0"
                        ToolTip="Изменить данные работника">
                        <Image Source="/Resources/Icons/change.png" />
                </Button>
                <Button Command="{Binding DeleteEmployeeCommand}" Style="{StaticResource ToolbarButton}" Margin="10,0,0,0"
                        ToolTip="Удалить работника">
                        <Image Source="/Resources/Icons/delete.png" />
                </Button>
            </ToolBar>

            <!-- Group 3: Visibility -->
            <ToolBar Band="1" BandIndex="3" Width="110">
                <ToggleButton Command="{Binding ChangeAgeVisibilityCommand}"
                              IsChecked="{Binding IsAgeVisible}" 
                              Style="{StaticResource ToolbarToggleButton}"
                              ToolTip="Показывать возраст">
                    <Image Source="/Resources/Icons/oldman.png" />
                </ToggleButton>
                <ToggleButton Command="{Binding ChangeSalaryVisibilityCommand}"
                              IsChecked="{Binding IsSalaryVisible}" 
                              Style="{StaticResource ToolbarToggleButton}" Margin="10,0,0,0"
                              ToolTip="Показывать зарплату">
                              <Image Source="/Resources/Icons/money.png" />
                </ToggleButton>
            </ToolBar>
        </ToolBarTray>

        <!-- Список сотрудников -->
        <Grid Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="{Binding AgeWidth}"/>
                    <ColumnDefinition Width="{Binding SalaryWidth}"/>
                    <ColumnDefinition Width="{Binding EmptyWidth}"/>
                </Grid.ColumnDefinitions>
                <Grid Grid.Column="0" x:Name="Col0"/>
                <Grid Grid.Column="1" x:Name="Col1"/>
                <Grid Grid.Column="2" x:Name="Col2"/>
                <Grid Grid.Column="3" x:Name="Col3" />
                <Grid Grid.Column="4" x:Name="Col4" />
            </Grid>

            <ListView ItemsSource="{Binding Employees}">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="Имя" Width="{Binding ElementName=Col0,Path=ActualWidth}" DisplayMemberBinding="{Binding Path=Name}"/>
                        <GridViewColumn Header="Фамилия" Width="{Binding ElementName=Col1,Path=ActualWidth}" DisplayMemberBinding="{Binding Path=Surname}"/>
                        <GridViewColumn Header="Возраст" Width="{Binding ElementName=Col2,Path=ActualWidth}" DisplayMemberBinding="{Binding Path=Age}"/>
                        <GridViewColumn Header="Зарплата" Width="{Binding ElementName=Col3,Path=ActualWidth}" DisplayMemberBinding="{Binding Path=Salary}"/>
                        <GridViewColumn Header="" Width="{Binding ElementName=Col4,Path=ActualWidth}"  DisplayMemberBinding="{Binding Path=Empty}"/>
                    </GridView>
                </ListView.View>
            </ListView>
        </Grid>
        <!--<ListView x:Name="myListView" Grid.Row="1"
                    ItemsSource="{Binding Employees}"
                    SelectedItem="{Binding SelectedEmployee}"
                    Margin="5"
                  HorizontalAlignment="Stretch">
            <ListView.View>
                <GridView>
                    <GridView.Columns>
                        --><!-- Имя 30% ширины --><!--
                        <GridViewColumn Header="Имя" 
                            DisplayMemberBinding="{Binding Name}">
                            <GridViewColumn.Width>
                                <MultiBinding Converter="{StaticResource WidthConverter}" ConverterParameter="0.3">
                                    <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ListView}}" Path="ActualWidth"/>
                                </MultiBinding>
                            </GridViewColumn.Width>
                        </GridViewColumn>

                        --><!-- Фамилия 30% ширины --><!--
                        <GridViewColumn Header="Фамилия" 
                            DisplayMemberBinding="{Binding Surname}">
                            <GridViewColumn.Width>
                                <MultiBinding Converter="{StaticResource WidthConverter}" ConverterParameter="0.3">
                                    <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ListView}}" Path="ActualWidth"/>
                                </MultiBinding>
                            </GridViewColumn.Width>
                        </GridViewColumn>

                        --><!-- Возраст 20% ширины --><!--
                        <GridViewColumn Header="Возраст"
                            DisplayMemberBinding="{Binding Age}">
                            <GridViewColumn.Width>
                                <MultiBinding Converter="{StaticResource WidthConverter}" ConverterParameter="0.2">
                                    <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ListView}}" Path="ActualWidth"/>
                                </MultiBinding>
                            </GridViewColumn.Width>
                        </GridViewColumn>

                        --><!-- Зарплата 20% ширины --><!--
                        <GridViewColumn Header="Зарплата" 
                            DisplayMemberBinding="{Binding Salary}">
                            <GridViewColumn.Width>
                                <MultiBinding Converter="{StaticResource WidthConverter}" ConverterParameter="0.2">
                                    <Binding RelativeSource="{RelativeSource FindAncestor, AncestorType={x:Type ListView}}" Path="ActualWidth"/>
                                </MultiBinding>
                            </GridViewColumn.Width>
                        </GridViewColumn>
                    </GridView.Columns>
                </GridView>
            </ListView.View>
        </ListView>-->
        <!-- Индикатор загрузки -->
        <!--<Grid Grid.Row="1" Background="White"
            Visibility="{Binding IsLoading, Converter={StaticResource b2v}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="{Binding StatusMessage}" 
                   FontSize="24" 
                   Foreground="Black" 
                   HorizontalAlignment="Center"/>
                <ProgressBar IsIndeterminate="True" 
                     Width="200" 
                     Height="10" 
                     Margin="0,10"/>
            </StackPanel>
        </Grid>-->
        <!-- Добавление работника -->
        <!--<Grid Grid.Row="1" Background="White"
            Visibility="{Binding IsAddingEmployee, Converter={StaticResource b2v}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <dlg:EditDialog></dlg:EditDialog>
            </StackPanel>
        </Grid>-->
    </Grid>
</Window>
